---
title: "CCFRP Central California Fork Length and Total Length Comparison"
author: "Rachel Brooks"
date: "2023-03-17"
output: pdf_document
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = TRUE, error=FALSE)

rm(list = ls());graphics.off()
library(tidyverse) # For data manipulation and summarization
library(plotrix) #To use standard error calculation
library(cowplot) #For grouping plots
library(scales) #For editing axis scales
library(rstatix) #For running ANCOVA
#library(ggpmisc) #adding equation and r2 to figures
library(here) ## for erin

alpha=0.5
formula<-y~x
theme_set(theme_classic(base_size=16))

```

Load Data

```{r}

length.data <-read.csv(here("Data", 'Fork-And-Total-Length-Data.csv'))

```
Blue/Deacon Rockfish

```{r}

blue.deacon<-length.data%>%
  group_by(Institution, Species, Data.Source)%>%
  filter(Species == "Blue/Deacon Rockfish")

ggplot(blue.deacon, aes(x=Fork.Length..cm., y=Total.Length..cm., col=Institution))+
  geom_point()+
  geom_smooth(method = "lm")+ 
  ggtitle("Blue/Deacon Rockfish") +
  xlab("Fork Length (cm)") + ylab("Total Length (cm)")

ggplot(blue.deacon, aes(x=Fork.Length..cm., y=Total.Length..cm., col=Data.Source))+
  geom_point()+
  geom_smooth(method = "lm")+ 
  ggtitle("Blue/Deacon Rockfish") +
  xlab("Fork Length (cm)") + ylab("Total Length (cm)")

ggplot(blue.deacon, aes(x=Fork.Length..cm., y=Total.Length..cm.))+
  geom_point()+
  geom_smooth(method = "lm")+ 
  ggtitle("Blue/Deacon Rockfish") +
  xlab("Fork Length (cm)") + ylab("Total Length (cm)")
  
MOD <- lm(Fork.Length..cm.~Total.Length..cm., data = blue.deacon)
  summary(MOD)
  hist(MOD$residuals)

```

Black Rockfish

```{r}

black<-length.data%>%
  group_by(Institution, Species, Data.Source)%>%
  filter(Species == "Black Rockfish")

ggplot(black, aes(x=Fork.Length..cm., y=Total.Length..cm., col=Institution))+
  geom_point()+
  geom_smooth(method = "lm")+ 
  ggtitle("Black Rockfish") +
  xlab("Fork Length (cm)") + ylab("Total Length (cm)")

ggplot(black, aes(x=Fork.Length..cm., y=Total.Length..cm., col=Data.Source))+
  geom_point()+
  geom_smooth(method = "lm")+ 
  ggtitle("Black Rockfish") +
  xlab("Fork Length (cm)") + ylab("Total Length (cm)")

ggplot(black, aes(x=Fork.Length..cm., y=Total.Length..cm.))+
  geom_point()+
  geom_smooth(method = "lm")+ 
  ggtitle("Black Rockfish") +
  xlab("Fork Length (cm)") + ylab("Total Length (cm)")
  
MOD <- lm(Fork.Length..cm.~Total.Length..cm., data = black)
  summary(MOD)
  hist(MOD$residuals)
  
```


Vermilion Rockfish

```{r}

vermilion<-length.data%>%
  group_by(Institution, Species, Data.Source)%>%
  filter(Species == "Vermilion Rockfish")

ggplot(vermilion, aes(x=Fork.Length..cm., y=Total.Length..cm., col=Institution))+
  geom_point()+
  geom_smooth(method = "lm")+ 
  ggtitle("Vermilion Rockfish") +
  xlab("Fork Length (cm)") + ylab("Total Length (cm)")

ggplot(vermilion, aes(x=Fork.Length..cm., y=Total.Length..cm., col=Data.Source))+
  geom_point()+
  geom_smooth(method = "lm")+ 
  ggtitle("Vermilion Rockfish") +
  xlab("Fork Length (cm)") + ylab("Total Length (cm)")

ggplot(vermilion, aes(x=Fork.Length..cm., y=Total.Length..cm.))+
  geom_point()+
  geom_smooth(method = "lm")+ 
  ggtitle("Vermilion Rockfish") +
  xlab("Fork Length (cm)") + ylab("Total Length (cm)")
  
MOD <- lm(Fork.Length..cm.~Total.Length..cm., data = vermilion)
  summary(MOD)
  hist(MOD$residuals)
  
```



Olive/Yellowtail Rockfish

```{r}

olive.yellowtail<-length.data%>%
  group_by(Institution, Species, Data.Source)%>%
  filter(Species == "Olive/Yellowtail Rockfish")

ggplot(olive.yellowtail, aes(x=Fork.Length..cm., y=Total.Length..cm., col=Institution))+
  geom_point()+
  geom_smooth(method = "lm")+ 
  ggtitle("Olive/Yellowtail Rockfish") +
  xlab("Fork Length (cm)") + ylab("Total Length (cm)")

ggplot(olive.yellowtail, aes(x=Fork.Length..cm., y=Total.Length..cm., col=Data.Source))+
  geom_point()+
  geom_smooth(method = "lm")+ 
  ggtitle("Olive/Yellowtail Rockfish") +
  xlab("Fork Length (cm)") + ylab("Total Length (cm)")

ggplot(olive.yellowtail, aes(x=Fork.Length..cm., y=Total.Length..cm.))+
  geom_point()+
  geom_smooth(method = "lm")+ 
  ggtitle("Olive/Yellowtail Rockfish") +
  xlab("Fork Length (cm)") + ylab("Total Length (cm)")
  
MOD <- lm(Fork.Length..cm.~Total.Length..cm., data = olive.yellowtail)
  summary(MOD)
  hist(MOD$residuals)
  
```

Copper Rockfish

```{r}

copper<-length.data%>%
  group_by(Institution, Species, Data.Source)%>%
  filter(Species == "Copper Rockfish")

ggplot(copper, aes(x=Fork.Length..cm., y=Total.Length..cm., col=Institution))+
  geom_point()+
  geom_smooth(method = "lm")+ 
  ggtitle("Copper Rockfish") +
  xlab("Fork Length (cm)") + ylab("Total Length (cm)")

ggplot(copper, aes(x=Fork.Length..cm., y=Total.Length..cm., col=Data.Source))+
  geom_point()+
  geom_smooth(method = "lm")+ 
  ggtitle("Copper Rockfish") +
  xlab("Fork Length (cm)") + ylab("Total Length (cm)")

ggplot(copper, aes(x=Fork.Length..cm., y=Total.Length..cm.))+
  geom_point()+
  geom_smooth(method = "lm")+ 
  ggtitle("Copper Rockfish") +
  xlab("Fork Length (cm)") + ylab("Total Length (cm)")
  
MOD <- lm(Fork.Length..cm.~Total.Length..cm., data = copper)
  summary(MOD)
  hist(MOD$residuals)
  
```


Canary Rockfish

```{r}

canary<-length.data%>%
  group_by(Institution, Species, Data.Source)%>%
  filter(Species == "Canary Rockfish")

ggplot(canary, aes(x=Fork.Length..cm., y=Total.Length..cm., col=Institution))+
  geom_point()+
  geom_smooth(method = "lm")+ 
  ggtitle("Canary Rockfish") +
  xlab("Fork Length (cm)") + ylab("Total Length (cm)")

ggplot(canary, aes(x=Fork.Length..cm., y=Total.Length..cm., col=Data.Source))+
  geom_point()+
  geom_smooth(method = "lm")+ 
  ggtitle("Canary Rockfish") +
  xlab("Fork Length (cm)") + ylab("Total Length (cm)")

ggplot(canary, aes(x=Fork.Length..cm., y=Total.Length..cm.))+
  geom_point()+
  geom_smooth(method = "lm")+ 
  ggtitle("Canary Rockfish") +
  xlab("Fork Length (cm)") + ylab("Total Length (cm)")
  
MOD <- lm(Fork.Length..cm.~Total.Length..cm., data = canary)
  summary(MOD)
  hist(MOD$residuals)
  
```


Same comparisons, but binned in 2 cm length bins


```{r data}

length_dat <- read_csv(here("Data", "Fork-And-Total-Length-Data2.csv"))
str(length_dat)

length_dat %>% arrange(desc(TL)) %>% slice(1)
length_dat %>% arrange(desc(FL)) %>% slice(1)
length_dat %>% arrange(TL) %>% slice(1)
length_dat %>% arrange(FL) %>% slice(1)


```

```{r}

bin_dat <- length_dat %>%
  mutate(TL_bin = cut(TL, breaks = c(0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,
                                     32,34,36,38,40,42,44,46,48,50,52,54,56,58,60,
                                     62,64)),
         FL_bin = cut(FL, breaks = c(0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,
                                     32,34,36,38,40,42,44,46,48,50,52,54,56,58,60,
                                     62,64)),
         match = case_when(
           TL_bin == FL_bin ~ "YES",
           TL_bin != FL_bin ~ "NO"
         ))

bin_dat %>% count(match)

bin_dat %>% filter(Species == "Blue/Deacon Rockfish") %>% count(match)

bin_dat %>% filter(!Species == "Canary Rockfish") %>% count(match)

ggplot(data = bin_dat)+
  geom_bar(aes(x = TL_bin), fill = "Blue", alpha = 0.5)+
  geom_bar(aes(x = FL_bin), fill = "Green", alpha = 0.5)

```


```{r}

## the annoying long bin conversion



```

